============================================
cva6/cva6_instr_sequence
============================================

/*
 * Copyright 2018 Google LLC
 * Copyright 2023 Thales DIS

 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

//-----------------------------------------------------------------------------------------
// CVA6 instruction sequence, this add unsupported extension instructions to
// hint/illegal instructions
//-----------------------------------------------------------------------------------------

class cva6_instr_sequence_c extends riscv_instr_sequence;

  cva6_instr_gen_config_c       cfg_cva6;                 // Configuration class handle
  cva6_unsupported_instr_c      unsupported_instr;        // unsupported instruction generator
  int                           unsupported_instr_pct;    // Percentage of unsupported instruction

  `uvm_object_utils(cva6_instr_sequence_c)

  function new (string name = "");
    super.new(name);
    unsupported_instr = cva6_unsupported_instr_c::type_id::create("unsupported_instr");
    illegal_instr     = cva6_illegal_instr_c::type_id::create("illegal_instr");
  endfunction

  function void insert_unsupported_instr();
    int bin_instr_cnt;
    int idx;
    string str;
    `DV_CHECK_FATAL($cast(cfg_cva6, cfg), "Could not cast cfg into cfg_cva6")
    bin_instr_cnt = instr_cnt * cfg_cva6.unsupported_instr_ratio / 1000;
    if (bin_instr_cnt >= 0) begin
      `uvm_info(`gfn, $sformatf("Injecting %0d unsupported instructions, ratio %0d/100",
                      bin_instr_cnt, cfg_cva6.unsupported_instr_ratio), UVM_LOW)
      repeat (bin_instr_cnt) begin
        `DV_CHECK_RANDOMIZE_WITH_FATAL(unsupported_instr, 
                                       unsupported_instr inside {rv64i_instr, rv64c_instr, rv64m_instr, rvfdq_instr, illegal_slli_srai, sys_instr,
                                                                 illegal_rv32zcb_instr, rv64zcb_instr, rv32vf_instr};)
        if (unsupported_instr.compressed) begin
           str = {indent, $sformatf(".2byte 0x%s # %0s",
                          unsupported_instr.get_bin_str(), unsupported_instr.comment)};
                  idx = $urandom_range(0, instr_string_list.size());
           instr_string_list.insert(idx, str);
        end
        else begin
           str = {indent, $sformatf(".4byte 0x%s # %0s",
                          unsupported_instr.get_bin_str(), unsupported_instr.comment)};
                  idx = $urandom_range(0, instr_string_list.size());
           instr_string_list.insert(idx, str);
        end
      end
    end
  endfunction

  function void insert_illegal_hint_instr();
    int bin_instr_cnt;
    int idx;
    string str;
    illegal_instr.init(cfg);
    bin_instr_cnt = instr_cnt * cfg.illegal_instr_ratio / 1000;
    if (bin_instr_cnt >= 0) begin
      `uvm_info(`gfn, $sformatf("Injecting %0d cva6 illegal instructions, ratio %0d/100",
                      bin_instr_cnt, cfg.illegal_instr_ratio), UVM_LOW)
      repeat (bin_instr_cnt) begin
        `DV_CHECK_RANDOMIZE_WITH_FATAL(illegal_instr,
                                       exception != kHintInstr;)
        str = {indent, $sformatf(".4byte 0x%s # %0s",
                       illegal_instr.get_bin_str(), illegal_instr.comment)};
               idx = $urandom_range(0, instr_string_list.size());
        instr_string_list.insert(idx, str);
      end
    end
    bin_instr_cnt = instr_cnt * cfg.hint_instr_ratio / 1000;
    if (bin_instr_cnt >= 0) begin
      `uvm_info(`gfn, $sformatf("Injecting %0d HINT instructions, ratio %0d/100",
                      bin_instr_cnt, cfg.illegal_instr_ratio), UVM_LOW)
      repeat (bin_instr_cnt) begin
        `DV_CHECK_RANDOMIZE_WITH_FATAL(illegal_instr,
                                       exception == kHintInstr;)
        str = {indent, $sformatf(".2byte 0x%s # %0s",
                       illegal_instr.get_bin_str(), illegal_instr.comment)};
        idx = $urandom_range(0, instr_string_list.size());
        instr_string_list.insert(idx, str);
      end
    end
  endfunction

  // Convert the instruction stream to the string format.
  // Label is attached to the instruction if available, otherwise attach proper space to make
  // the code indent consistent.
  function void generate_unsupported_instr_stream(bit no_label = 1'b0);
    string prefix, str;
    int i;
    instr_string_list = {};
    for(i = 0; i < instr_stream.instr_list.size(); i++) begin
      if(i == 0) begin
        if (no_label) begin
          prefix = format_string(" ", LABEL_STR_LEN);
        end else begin
          prefix = format_string($sformatf("%0s:", label_name), LABEL_STR_LEN);
        end
        instr_stream.instr_list[i].has_label = 1'b1;
      end else begin
        if(instr_stream.instr_list[i].has_label) begin
          prefix = format_string($sformatf("%0s:", instr_stream.instr_list[i].label),
                   LABEL_STR_LEN);
        end else begin
          prefix = format_string(" ", LABEL_STR_LEN);
        end
      end
      str = {prefix, instr_stream.instr_list[i].convert2asm()};
      instr_string_list.push_back(str);
    end
    insert_unsupported_instr();
    insert_illegal_hint_instr();
    prefix = format_string($sformatf("%0d:", i), LABEL_STR_LEN);
    if(!is_main_program) begin
      generate_return_routine(prefix);
    end
  endfunction

endclass

----

(source_file
  (block_comment)
  (one_line_comment)
  (one_line_comment)
  (one_line_comment)
  (one_line_comment)
  (class_declaration
    name: (simple_identifier)
    (class_type
      (simple_identifier))
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (simple_identifier)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (one_line_comment)
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (simple_identifier)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (one_line_comment)
    (class_item
      (class_property
        (data_declaration
          (data_type_or_implicit
            (data_type
              (integer_atom_type)))
          (list_of_variable_decl_assignments
            (variable_decl_assignment
              name: (simple_identifier))))))
    (one_line_comment)
    (class_item
      (text_macro_usage
        (simple_identifier)
        (list_of_actual_arguments
          (actual_argument
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier))))))))))
    (class_item
      (class_method
        (class_constructor_declaration
          (class_constructor_arg_list
            (class_constructor_arg
              (tf_port_item
                (data_type_or_implicit
                  (data_type))
                name: (simple_identifier)
                (expression
                  (primary
                    (primary_literal
                      (string_literal
                        (quoted_string))))))))
          (list_of_arguments
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (function_statement_or_null
            (function_statement
              (statement
                (statement_item
                  (blocking_assignment
                    (operator_assignment
                      (variable_lvalue
                        (hierarchical_identifier
                          (simple_identifier)))
                      (assignment_operator)
                      (expression
                        (primary
                          (function_subroutine_call
                            (subroutine_call
                              (method_call
                                (primary
                                  (function_subroutine_call
                                    (subroutine_call
                                      (method_call
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier)))
                                        (method_call_body
                                          name: (simple_identifier))))))
                                (method_call_body
                                  name: (simple_identifier)
                                  arguments: (list_of_arguments
                                    (expression
                                      (primary
                                        (primary_literal
                                          (string_literal
                                            (quoted_string
                                              (quoted_string_item)))))))))))))))))))
          (function_statement_or_null
            (function_statement
              (statement
                (statement_item
                  (blocking_assignment
                    (operator_assignment
                      (variable_lvalue
                        (hierarchical_identifier
                          (simple_identifier)))
                      (assignment_operator)
                      (expression
                        (primary
                          (function_subroutine_call
                            (subroutine_call
                              (method_call
                                (primary
                                  (function_subroutine_call
                                    (subroutine_call
                                      (method_call
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier)))
                                        (method_call_body
                                          name: (simple_identifier))))))
                                (method_call_body
                                  name: (simple_identifier)
                                  arguments: (list_of_arguments
                                    (expression
                                      (primary
                                        (primary_literal
                                          (string_literal
                                            (quoted_string
                                              (quoted_string_item))))))))))))))))))))))
    (class_item
      (class_method
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type
                    (integer_atom_type)))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type
                    (integer_atom_type)))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (text_macro_usage
                      (simple_identifier)
                      (list_of_actual_arguments
                        (actual_argument
                          (param_expression
                            (mintypmax_expression
                              (expression
                                (primary
                                  (function_subroutine_call
                                    (subroutine_call
                                      (system_tf_call
                                        (system_tf_identifier)
                                        (list_of_arguments
                                          (expression
                                            (primary
                                              (hierarchical_identifier
                                                (simple_identifier))))
                                          (expression
                                            (primary
                                              (hierarchical_identifier
                                                (simple_identifier)))))))))))))
                        (actual_argument
                          (param_expression
                            (mintypmax_expression
                              (expression
                                (primary
                                  (primary_literal
                                    (string_literal
                                      (quoted_string
                                        (quoted_string_item)))))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          left: (expression
                            left: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            right: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)
                                  (simple_identifier)))))
                          right: (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (conditional_statement
                      (cond_predicate
                        (expression
                          left: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))
                          right: (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number))))))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (seq_block
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (text_macro_usage
                                      (simple_identifier)
                                      (list_of_actual_arguments
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (text_macro_usage
                                                  (simple_identifier))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (function_subroutine_call
                                                    (subroutine_call
                                                      (system_tf_call
                                                        (system_tf_identifier)
                                                        (list_of_arguments
                                                          (expression
                                                            (primary
                                                              (primary_literal
                                                                (string_literal
                                                                  (quoted_string
                                                                    (quoted_string_item))))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier)
                                                                (simple_identifier)))))))))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier))))))))))))
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (loop_statement
                                      (expression
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier))))
                                      (statement_or_null
                                        (statement
                                          (statement_item
                                            (seq_block
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (text_macro_usage
                                                      (simple_identifier)
                                                      (list_of_actual_arguments
                                                        (actual_argument
                                                          (param_expression
                                                            (mintypmax_expression
                                                              (expression
                                                                (primary
                                                                  (hierarchical_identifier
                                                                    (simple_identifier)))))))
                                                        (actual_argument
                                                          (constraint_block_item
                                                            (constraint_expression
                                                              (expression_or_dist
                                                                (expression
                                                                  (inside_expression
                                                                    (expression
                                                                      (primary
                                                                        (hierarchical_identifier
                                                                          (simple_identifier))))
                                                                    (range_list
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))
                                                                      (value_range
                                                                        (expression
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (conditional_statement
                                                      (cond_predicate
                                                        (expression
                                                          (primary
                                                            (hierarchical_identifier
                                                              (simple_identifier)
                                                              (simple_identifier)))))
                                                      (statement_or_null
                                                        (statement
                                                          (statement_item
                                                            (seq_block
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (concatenation
                                                                              (expression
                                                                                (primary
                                                                                  (hierarchical_identifier
                                                                                    (simple_identifier))))
                                                                              (expression
                                                                                (primary
                                                                                  (function_subroutine_call
                                                                                    (subroutine_call
                                                                                      (system_tf_call
                                                                                        (system_tf_identifier)
                                                                                        (list_of_arguments
                                                                                          (expression
                                                                                            (primary
                                                                                              (primary_literal
                                                                                                (string_literal
                                                                                                  (quoted_string
                                                                                                    (quoted_string_item))))))
                                                                                          (expression
                                                                                            (primary
                                                                                              (function_subroutine_call
                                                                                                (subroutine_call
                                                                                                  (tf_call
                                                                                                    (hierarchical_identifier
                                                                                                      (simple_identifier)
                                                                                                      (simple_identifier)))))))
                                                                                          (expression
                                                                                            (primary
                                                                                              (hierarchical_identifier
                                                                                                (simple_identifier)
                                                                                                (simple_identifier))))))))))))))))))
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (function_subroutine_call
                                                                              (subroutine_call
                                                                                (system_tf_call
                                                                                  (system_tf_identifier)
                                                                                  (list_of_arguments
                                                                                    (expression
                                                                                      (primary
                                                                                        (primary_literal
                                                                                          (integral_number
                                                                                            (decimal_number
                                                                                              (unsigned_number))))))
                                                                                    (expression
                                                                                      (primary
                                                                                        (function_subroutine_call
                                                                                          (subroutine_call
                                                                                            (method_call
                                                                                              (primary
                                                                                                (hierarchical_identifier
                                                                                                  (simple_identifier)))
                                                                                              (method_call_body
                                                                                                (array_or_queue_method_call
                                                                                                  (array_or_queue_method_name)))))))))))))))))))
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (subroutine_call_statement
                                                                      (subroutine_call
                                                                        (method_call
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))
                                                                          (method_call_body
                                                                            (queue_method_call
                                                                              (queue_method_name)
                                                                              (list_of_arguments
                                                                                (expression
                                                                                  (primary
                                                                                    (hierarchical_identifier
                                                                                      (simple_identifier))))
                                                                                (expression
                                                                                  (primary
                                                                                    (hierarchical_identifier
                                                                                      (simple_identifier)))))))))))))))))
                                                      (statement_or_null
                                                        (statement
                                                          (statement_item
                                                            (seq_block
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (concatenation
                                                                              (expression
                                                                                (primary
                                                                                  (hierarchical_identifier
                                                                                    (simple_identifier))))
                                                                              (expression
                                                                                (primary
                                                                                  (function_subroutine_call
                                                                                    (subroutine_call
                                                                                      (system_tf_call
                                                                                        (system_tf_identifier)
                                                                                        (list_of_arguments
                                                                                          (expression
                                                                                            (primary
                                                                                              (primary_literal
                                                                                                (string_literal
                                                                                                  (quoted_string
                                                                                                    (quoted_string_item))))))
                                                                                          (expression
                                                                                            (primary
                                                                                              (function_subroutine_call
                                                                                                (subroutine_call
                                                                                                  (tf_call
                                                                                                    (hierarchical_identifier
                                                                                                      (simple_identifier)
                                                                                                      (simple_identifier)))))))
                                                                                          (expression
                                                                                            (primary
                                                                                              (hierarchical_identifier
                                                                                                (simple_identifier)
                                                                                                (simple_identifier))))))))))))))))))
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (function_subroutine_call
                                                                              (subroutine_call
                                                                                (system_tf_call
                                                                                  (system_tf_identifier)
                                                                                  (list_of_arguments
                                                                                    (expression
                                                                                      (primary
                                                                                        (primary_literal
                                                                                          (integral_number
                                                                                            (decimal_number
                                                                                              (unsigned_number))))))
                                                                                    (expression
                                                                                      (primary
                                                                                        (function_subroutine_call
                                                                                          (subroutine_call
                                                                                            (method_call
                                                                                              (primary
                                                                                                (hierarchical_identifier
                                                                                                  (simple_identifier)))
                                                                                              (method_call_body
                                                                                                (array_or_queue_method_call
                                                                                                  (array_or_queue_method_name)))))))))))))))))))
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (subroutine_call_statement
                                                                      (subroutine_call
                                                                        (method_call
                                                                          (primary
                                                                            (hierarchical_identifier
                                                                              (simple_identifier)))
                                                                          (method_call_body
                                                                            (queue_method_call
                                                                              (queue_method_name)
                                                                              (list_of_arguments
                                                                                (expression
                                                                                  (primary
                                                                                    (hierarchical_identifier
                                                                                      (simple_identifier))))
                                                                                (expression
                                                                                  (primary
                                                                                    (hierarchical_identifier
                                                                                      (simple_identifier))))))))))))))))))))))))))))))))))))))))))
    (class_item
      (class_method
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type
                    (integer_atom_type)))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type
                    (integer_atom_type)))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (tf_call
                          (hierarchical_identifier
                            (simple_identifier)
                            (simple_identifier))
                          (list_of_arguments
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          left: (expression
                            left: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            right: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)
                                  (simple_identifier)))))
                          right: (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (conditional_statement
                      (cond_predicate
                        (expression
                          left: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))
                          right: (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number))))))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (seq_block
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (text_macro_usage
                                      (simple_identifier)
                                      (list_of_actual_arguments
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (text_macro_usage
                                                  (simple_identifier))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (function_subroutine_call
                                                    (subroutine_call
                                                      (system_tf_call
                                                        (system_tf_identifier)
                                                        (list_of_arguments
                                                          (expression
                                                            (primary
                                                              (primary_literal
                                                                (string_literal
                                                                  (quoted_string
                                                                    (quoted_string_item))))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier)
                                                                (simple_identifier)))))))))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier))))))))))))
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (loop_statement
                                      (expression
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier))))
                                      (statement_or_null
                                        (statement
                                          (statement_item
                                            (seq_block
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (text_macro_usage
                                                      (simple_identifier)
                                                      (list_of_actual_arguments
                                                        (actual_argument
                                                          (param_expression
                                                            (mintypmax_expression
                                                              (expression
                                                                (primary
                                                                  (hierarchical_identifier
                                                                    (simple_identifier)))))))
                                                        (actual_argument
                                                          (constraint_block_item
                                                            (constraint_expression
                                                              (expression_or_dist
                                                                (expression
                                                                  left: (expression
                                                                    (primary
                                                                      (hierarchical_identifier
                                                                        (simple_identifier))))
                                                                  right: (expression
                                                                    (primary
                                                                      (hierarchical_identifier
                                                                        (simple_identifier))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (blocking_assignment
                                                      (operator_assignment
                                                        (variable_lvalue
                                                          (hierarchical_identifier
                                                            (simple_identifier)))
                                                        (assignment_operator)
                                                        (expression
                                                          (primary
                                                            (concatenation
                                                              (expression
                                                                (primary
                                                                  (hierarchical_identifier
                                                                    (simple_identifier))))
                                                              (expression
                                                                (primary
                                                                  (function_subroutine_call
                                                                    (subroutine_call
                                                                      (system_tf_call
                                                                        (system_tf_identifier)
                                                                        (list_of_arguments
                                                                          (expression
                                                                            (primary
                                                                              (primary_literal
                                                                                (string_literal
                                                                                  (quoted_string
                                                                                    (quoted_string_item))))))
                                                                          (expression
                                                                            (primary
                                                                              (function_subroutine_call
                                                                                (subroutine_call
                                                                                  (tf_call
                                                                                    (hierarchical_identifier
                                                                                      (simple_identifier)
                                                                                      (simple_identifier)))))))
                                                                          (expression
                                                                            (primary
                                                                              (hierarchical_identifier
                                                                                (simple_identifier)
                                                                                (simple_identifier))))))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (blocking_assignment
                                                      (operator_assignment
                                                        (variable_lvalue
                                                          (hierarchical_identifier
                                                            (simple_identifier)))
                                                        (assignment_operator)
                                                        (expression
                                                          (primary
                                                            (function_subroutine_call
                                                              (subroutine_call
                                                                (system_tf_call
                                                                  (system_tf_identifier)
                                                                  (list_of_arguments
                                                                    (expression
                                                                      (primary
                                                                        (primary_literal
                                                                          (integral_number
                                                                            (decimal_number
                                                                              (unsigned_number))))))
                                                                    (expression
                                                                      (primary
                                                                        (function_subroutine_call
                                                                          (subroutine_call
                                                                            (method_call
                                                                              (primary
                                                                                (hierarchical_identifier
                                                                                  (simple_identifier)))
                                                                              (method_call_body
                                                                                (array_or_queue_method_call
                                                                                  (array_or_queue_method_name)))))))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (subroutine_call_statement
                                                      (subroutine_call
                                                        (method_call
                                                          (primary
                                                            (hierarchical_identifier
                                                              (simple_identifier)))
                                                          (method_call_body
                                                            (queue_method_call
                                                              (queue_method_name)
                                                              (list_of_arguments
                                                                (expression
                                                                  (primary
                                                                    (hierarchical_identifier
                                                                      (simple_identifier))))
                                                                (expression
                                                                  (primary
                                                                    (hierarchical_identifier
                                                                      (simple_identifier))))))))))))))))))))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          left: (expression
                            left: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            right: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)
                                  (simple_identifier)))))
                          right: (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number)))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (conditional_statement
                      (cond_predicate
                        (expression
                          left: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))
                          right: (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number))))))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (seq_block
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (text_macro_usage
                                      (simple_identifier)
                                      (list_of_actual_arguments
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (text_macro_usage
                                                  (simple_identifier))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (function_subroutine_call
                                                    (subroutine_call
                                                      (system_tf_call
                                                        (system_tf_identifier)
                                                        (list_of_arguments
                                                          (expression
                                                            (primary
                                                              (primary_literal
                                                                (string_literal
                                                                  (quoted_string
                                                                    (quoted_string_item))))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier))))
                                                          (expression
                                                            (primary
                                                              (hierarchical_identifier
                                                                (simple_identifier)
                                                                (simple_identifier)))))))))))))
                                        (actual_argument
                                          (param_expression
                                            (mintypmax_expression
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier))))))))))))
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (loop_statement
                                      (expression
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier))))
                                      (statement_or_null
                                        (statement
                                          (statement_item
                                            (seq_block
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (text_macro_usage
                                                      (simple_identifier)
                                                      (list_of_actual_arguments
                                                        (actual_argument
                                                          (param_expression
                                                            (mintypmax_expression
                                                              (expression
                                                                (primary
                                                                  (hierarchical_identifier
                                                                    (simple_identifier)))))))
                                                        (actual_argument
                                                          (constraint_block_item
                                                            (constraint_expression
                                                              (expression_or_dist
                                                                (expression
                                                                  left: (expression
                                                                    (primary
                                                                      (hierarchical_identifier
                                                                        (simple_identifier))))
                                                                  right: (expression
                                                                    (primary
                                                                      (hierarchical_identifier
                                                                        (simple_identifier))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (blocking_assignment
                                                      (operator_assignment
                                                        (variable_lvalue
                                                          (hierarchical_identifier
                                                            (simple_identifier)))
                                                        (assignment_operator)
                                                        (expression
                                                          (primary
                                                            (concatenation
                                                              (expression
                                                                (primary
                                                                  (hierarchical_identifier
                                                                    (simple_identifier))))
                                                              (expression
                                                                (primary
                                                                  (function_subroutine_call
                                                                    (subroutine_call
                                                                      (system_tf_call
                                                                        (system_tf_identifier)
                                                                        (list_of_arguments
                                                                          (expression
                                                                            (primary
                                                                              (primary_literal
                                                                                (string_literal
                                                                                  (quoted_string
                                                                                    (quoted_string_item))))))
                                                                          (expression
                                                                            (primary
                                                                              (function_subroutine_call
                                                                                (subroutine_call
                                                                                  (tf_call
                                                                                    (hierarchical_identifier
                                                                                      (simple_identifier)
                                                                                      (simple_identifier)))))))
                                                                          (expression
                                                                            (primary
                                                                              (hierarchical_identifier
                                                                                (simple_identifier)
                                                                                (simple_identifier))))))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (blocking_assignment
                                                      (operator_assignment
                                                        (variable_lvalue
                                                          (hierarchical_identifier
                                                            (simple_identifier)))
                                                        (assignment_operator)
                                                        (expression
                                                          (primary
                                                            (function_subroutine_call
                                                              (subroutine_call
                                                                (system_tf_call
                                                                  (system_tf_identifier)
                                                                  (list_of_arguments
                                                                    (expression
                                                                      (primary
                                                                        (primary_literal
                                                                          (integral_number
                                                                            (decimal_number
                                                                              (unsigned_number))))))
                                                                    (expression
                                                                      (primary
                                                                        (function_subroutine_call
                                                                          (subroutine_call
                                                                            (method_call
                                                                              (primary
                                                                                (hierarchical_identifier
                                                                                  (simple_identifier)))
                                                                              (method_call_body
                                                                                (array_or_queue_method_call
                                                                                  (array_or_queue_method_name)))))))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (subroutine_call_statement
                                                      (subroutine_call
                                                        (method_call
                                                          (primary
                                                            (hierarchical_identifier
                                                              (simple_identifier)))
                                                          (method_call_body
                                                            (queue_method_call
                                                              (queue_method_name)
                                                              (list_of_arguments
                                                                (expression
                                                                  (primary
                                                                    (hierarchical_identifier
                                                                      (simple_identifier))))
                                                                (expression
                                                                  (primary
                                                                    (hierarchical_identifier
                                                                      (simple_identifier))))))))))))))))))))))))))))))))))
    (one_line_comment)
    (one_line_comment)
    (one_line_comment)
    (class_item
      (class_method
        (function_declaration
          (function_body_declaration
            (data_type_or_void)
            name: (simple_identifier)
            (tf_port_list
              (tf_port_item
                (data_type_or_implicit
                  (data_type
                    (integer_vector_type)))
                name: (simple_identifier)
                (expression
                  (primary
                    (primary_literal
                      (integral_number
                        (binary_number
                          size: (unsigned_number)
                          base: (binary_base)
                          value: (binary_value))))))))
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier))
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (block_item_declaration
              (data_declaration
                (data_type_or_implicit
                  (data_type
                    (integer_atom_type)))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier)))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          (primary
                            (empty_unpacked_array_concatenation)))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (loop_statement
                      (for_initialization
                        (list_of_variable_assignments
                          (variable_assignment
                            (variable_lvalue
                              (hierarchical_identifier
                                (simple_identifier)))
                            (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number)))))))))
                      (expression
                        left: (expression
                          (primary
                            (hierarchical_identifier
                              (simple_identifier))))
                        right: (expression
                          (primary
                            (function_subroutine_call
                              (subroutine_call
                                (method_call
                                  (primary
                                    (function_subroutine_call
                                      (subroutine_call
                                        (method_call
                                          (primary
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (method_call_body
                                            name: (simple_identifier))))))
                                  (method_call_body
                                    (array_or_queue_method_call
                                      (array_or_queue_method_name)))))))))
                      (for_step
                        (inc_or_dec_expression
                          (variable_lvalue
                            (hierarchical_identifier
                              (simple_identifier)))
                          (inc_or_dec_operator)))
                      (statement_or_null
                        (statement
                          (statement_item
                            (seq_block
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (conditional_statement
                                      (cond_predicate
                                        (expression
                                          left: (expression
                                            (primary
                                              (hierarchical_identifier
                                                (simple_identifier))))
                                          right: (expression
                                            (primary
                                              (primary_literal
                                                (integral_number
                                                  (decimal_number
                                                    (unsigned_number))))))))
                                      (statement_or_null
                                        (statement
                                          (statement_item
                                            (seq_block
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (conditional_statement
                                                      (cond_predicate
                                                        (expression
                                                          (primary
                                                            (hierarchical_identifier
                                                              (simple_identifier)))))
                                                      (statement_or_null
                                                        (statement
                                                          (statement_item
                                                            (seq_block
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (function_subroutine_call
                                                                              (subroutine_call
                                                                                (tf_call
                                                                                  (hierarchical_identifier
                                                                                    (simple_identifier))
                                                                                  (list_of_arguments
                                                                                    (expression
                                                                                      (primary
                                                                                        (primary_literal
                                                                                          (string_literal
                                                                                            (quoted_string
                                                                                              (quoted_string_item))))))
                                                                                    (expression
                                                                                      (primary
                                                                                        (hierarchical_identifier
                                                                                          (simple_identifier)))))))))))))))))))
                                                      (statement_or_null
                                                        (statement
                                                          (statement_item
                                                            (seq_block
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (function_subroutine_call
                                                                              (subroutine_call
                                                                                (tf_call
                                                                                  (hierarchical_identifier
                                                                                    (simple_identifier))
                                                                                  (list_of_arguments
                                                                                    (expression
                                                                                      (primary
                                                                                        (function_subroutine_call
                                                                                          (subroutine_call
                                                                                            (system_tf_call
                                                                                              (system_tf_identifier)
                                                                                              (list_of_arguments
                                                                                                (expression
                                                                                                  (primary
                                                                                                    (primary_literal
                                                                                                      (string_literal
                                                                                                        (quoted_string
                                                                                                          (quoted_string_item))))))
                                                                                                (expression
                                                                                                  (primary
                                                                                                    (hierarchical_identifier
                                                                                                      (simple_identifier))))))))))
                                                                                    (expression
                                                                                      (primary
                                                                                        (hierarchical_identifier
                                                                                          (simple_identifier)))))))))))))))))))))))
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (blocking_assignment
                                                      (operator_assignment
                                                        (variable_lvalue
                                                          (hierarchical_identifier
                                                            (simple_identifier)
                                                            (simple_identifier)
                                                            (constant_bit_select
                                                              (constant_expression
                                                                (constant_primary
                                                                  (simple_identifier))))
                                                            (simple_identifier)))
                                                        (assignment_operator)
                                                        (expression
                                                          (primary
                                                            (primary_literal
                                                              (integral_number
                                                                (binary_number
                                                                  size: (unsigned_number)
                                                                  base: (binary_base)
                                                                  value: (binary_value)))))))))))))))
                                      (statement_or_null
                                        (statement
                                          (statement_item
                                            (seq_block
                                              (statement_or_null
                                                (statement
                                                  (statement_item
                                                    (conditional_statement
                                                      (cond_predicate
                                                        (expression
                                                          (primary
                                                            (hierarchical_identifier
                                                              (simple_identifier)
                                                              (simple_identifier)
                                                              (constant_bit_select
                                                                (constant_expression
                                                                  (constant_primary
                                                                    (simple_identifier))))
                                                              (simple_identifier)))))
                                                      (statement_or_null
                                                        (statement
                                                          (statement_item
                                                            (seq_block
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (function_subroutine_call
                                                                              (subroutine_call
                                                                                (tf_call
                                                                                  (hierarchical_identifier
                                                                                    (simple_identifier))
                                                                                  (list_of_arguments
                                                                                    (expression
                                                                                      (primary
                                                                                        (function_subroutine_call
                                                                                          (subroutine_call
                                                                                            (system_tf_call
                                                                                              (system_tf_identifier)
                                                                                              (list_of_arguments
                                                                                                (expression
                                                                                                  (primary
                                                                                                    (primary_literal
                                                                                                      (string_literal
                                                                                                        (quoted_string
                                                                                                          (quoted_string_item))))))
                                                                                                (expression
                                                                                                  (primary
                                                                                                    (hierarchical_identifier
                                                                                                      (simple_identifier)
                                                                                                      (simple_identifier)
                                                                                                      (constant_bit_select
                                                                                                        (constant_expression
                                                                                                          (constant_primary
                                                                                                            (simple_identifier))))
                                                                                                      (simple_identifier))))))))))
                                                                                    (expression
                                                                                      (primary
                                                                                        (hierarchical_identifier
                                                                                          (simple_identifier)))))))))))))))))))
                                                      (statement_or_null
                                                        (statement
                                                          (statement_item
                                                            (seq_block
                                                              (statement_or_null
                                                                (statement
                                                                  (statement_item
                                                                    (blocking_assignment
                                                                      (operator_assignment
                                                                        (variable_lvalue
                                                                          (hierarchical_identifier
                                                                            (simple_identifier)))
                                                                        (assignment_operator)
                                                                        (expression
                                                                          (primary
                                                                            (function_subroutine_call
                                                                              (subroutine_call
                                                                                (tf_call
                                                                                  (hierarchical_identifier
                                                                                    (simple_identifier))
                                                                                  (list_of_arguments
                                                                                    (expression
                                                                                      (primary
                                                                                        (primary_literal
                                                                                          (string_literal
                                                                                            (quoted_string
                                                                                              (quoted_string_item))))))
                                                                                    (expression
                                                                                      (primary
                                                                                        (hierarchical_identifier
                                                                                          (simple_identifier)))))))))))))))))))))))))))))))
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (blocking_assignment
                                      (operator_assignment
                                        (variable_lvalue
                                          (hierarchical_identifier
                                            (simple_identifier)))
                                        (assignment_operator)
                                        (expression
                                          (primary
                                            (concatenation
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier))))
                                              (expression
                                                (primary
                                                  (function_subroutine_call
                                                    (subroutine_call
                                                      (tf_call
                                                        (hierarchical_identifier
                                                          (simple_identifier)
                                                          (simple_identifier)
                                                          (constant_bit_select
                                                            (constant_expression
                                                              (constant_primary
                                                                (simple_identifier))))
                                                          (simple_identifier)))))))))))))))
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (subroutine_call_statement
                                      (subroutine_call
                                        (method_call
                                          (primary
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (method_call_body
                                            (queue_method_call
                                              (queue_method_name)
                                              (list_of_arguments
                                                (expression
                                                  (primary
                                                    (hierarchical_identifier
                                                      (simple_identifier))))))))))))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (tf_call
                          (hierarchical_identifier
                            (simple_identifier)))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (tf_call
                          (hierarchical_identifier
                            (simple_identifier)))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (blocking_assignment
                      (operator_assignment
                        (variable_lvalue
                          (hierarchical_identifier
                            (simple_identifier)))
                        (assignment_operator)
                        (expression
                          (primary
                            (function_subroutine_call
                              (subroutine_call
                                (tf_call
                                  (hierarchical_identifier
                                    (simple_identifier))
                                  (list_of_arguments
                                    (expression
                                      (primary
                                        (function_subroutine_call
                                          (subroutine_call
                                            (system_tf_call
                                              (system_tf_identifier)
                                              (list_of_arguments
                                                (expression
                                                  (primary
                                                    (primary_literal
                                                      (string_literal
                                                        (quoted_string
                                                          (quoted_string_item))))))
                                                (expression
                                                  (primary
                                                    (hierarchical_identifier
                                                      (simple_identifier))))))))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier))))))))))))))))
            (function_statement_or_null
              (function_statement
                (statement
                  (statement_item
                    (conditional_statement
                      (cond_predicate
                        (expression
                          operator: (unary_operator)
                          argument: (primary
                            (hierarchical_identifier
                              (simple_identifier)))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (seq_block
                              (statement_or_null
                                (statement
                                  (statement_item
                                    (subroutine_call_statement
                                      (subroutine_call
                                        (tf_call
                                          (hierarchical_identifier
                                            (simple_identifier))
                                          (list_of_arguments
                                            (expression
                                              (primary
                                                (hierarchical_identifier
                                                  (simple_identifier))))))))))))))))))))))))))
