============================================
basejump_stl/testing/bsg_clk_gen/test_bsg
============================================

`define WIDTH_P 8   // unused for now...
`define NUM_ADGS_P 1

`include "bsg_tag.svh"

module test_bsg;

   import bsg_tag_pkg::bsg_tag_s;

   localparam bsg_num_adgs_lp  = `NUM_ADGS_P;
   localparam bsg_ds_width_lp  = `WIDTH_P;
   localparam bsg_tag_els_lp  = 2;

   `declare_bsg_clk_gen_osc_tag_payload_s(bsg_num_adgs_lp)
   `declare_bsg_clk_gen_ds_tag_payload_s(bsg_ds_width_lp)

   localparam max_payload_length_lp    = `BSG_MAX($bits(bsg_clk_gen_osc_tag_payload_s),$bits(bsg_clk_gen_ds_tag_payload_s));
   localparam lg_max_payload_length_lp = $clog2(max_payload_length_lp+1);

   `declare_bsg_tag_header_s(bsg_tag_els_lp,lg_max_payload_length_lp)

   wire clk_i, reset_i, bsg_tag_clk_o, bsg_tag_en_o, bsg_tag_data_o;

   wire [1:0] bsg_clk_gen_sel_o;
   wire       bsg_clk_gen_external_clk_o;
   wire       bsg_clk_gen_async_reset_o;
   wire       bsg_clk_gen_i;
   wire       ext_clk_i;

   bsg_nonsynth_clock_gen #(5ns) cfg_clk_gen (ext_clk_i);

   bsg_nonsynth_clk_gen_tester #(.num_adgs_p(bsg_num_adgs_lp)
                                 ,.ds_width_p(bsg_ds_width_lp)
                                 ,.tag_els_p(bsg_tag_els_lp)
                                 ) tester
     (.ext_clk_i
      ,.bsg_tag_clk_o
      ,.bsg_tag_en_o
      ,.bsg_tag_data_o

      ,.bsg_clk_gen_sel_o
      ,.bsg_clk_gen_async_reset_o

      ,.bsg_clk_gen_i
      );

  // Enable VPD dump file
  //
  initial
    begin
      $vcdpluson;
      $vcdplusmemon;
    end


  // Clock generator signals
  //

   bsg_tag_s [1:0] tags;

   bsg_tag_master #(.els_p(bsg_tag_els_lp)
                    ,.lg_width_p(lg_max_payload_length_lp)
                    ) btm
     (.clk_i       (bsg_tag_clk_o)
      ,.data_i     (bsg_tag_data_o)
      ,.en_i       (bsg_tag_en_o)
      ,.clients_r_o(tags)
      );

  bsg_clk_gen #(.downsample_width_p(bsg_ds_width_lp), .num_adgs_p(bsg_num_adgs_lp)) DUT
    (.bsg_osc_tag_i(tags[0])
     ,.bsg_ds_tag_i(tags[1])
     ,.async_osc_reset_i(bsg_clk_gen_async_reset_o)

    ,.ext_clk_i
    ,.select_i(bsg_clk_gen_sel_o)
    ,.clk_o(bsg_clk_gen_i)
    );


endmodule


----

(source_file
  (text_macro_definition
    (text_macro_name
      (simple_identifier))
    (macro_text))
  (text_macro_definition
    (text_macro_name
      (simple_identifier))
    (macro_text))
  (include_compiler_directive
    (quoted_string
      (quoted_string_item)))
  (module_declaration
    (module_ansi_header
      (module_keyword)
      name: (simple_identifier))
    (data_declaration
      (package_import_declaration
        (package_import_item
          (simple_identifier)
          (simple_identifier))))
    (local_parameter_declaration
      (list_of_param_assignments
        (param_assignment
          (simple_identifier)
          (constant_param_expression
            (constant_mintypmax_expression
              (constant_expression
                (text_macro_usage
                  (simple_identifier))))))))
    (local_parameter_declaration
      (list_of_param_assignments
        (param_assignment
          (simple_identifier)
          (constant_param_expression
            (constant_mintypmax_expression
              (constant_expression
                (text_macro_usage
                  (simple_identifier))))))))
    (local_parameter_declaration
      (list_of_param_assignments
        (param_assignment
          (simple_identifier)
          (constant_param_expression
            (constant_mintypmax_expression
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number)))))))))))
    (text_macro_usage
      (simple_identifier)
      (list_of_actual_arguments
        (actual_argument
          (param_expression
            (mintypmax_expression
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))))
    (text_macro_usage
      (simple_identifier)
      (list_of_actual_arguments
        (actual_argument
          (param_expression
            (mintypmax_expression
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))))
    (local_parameter_declaration
      (list_of_param_assignments
        (param_assignment
          (simple_identifier)
          (constant_param_expression
            (constant_mintypmax_expression
              (constant_expression
                (text_macro_usage
                  (simple_identifier)
                  (list_of_actual_arguments
                    (actual_argument
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (function_subroutine_call
                                (subroutine_call
                                  (system_tf_call
                                    (system_tf_identifier)
                                    (list_of_arguments
                                      (expression
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier)))))))))))))
                    (actual_argument
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (function_subroutine_call
                                (subroutine_call
                                  (system_tf_call
                                    (system_tf_identifier)
                                    (list_of_arguments
                                      (expression
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier)))))))))))))))))))))
    (local_parameter_declaration
      (list_of_param_assignments
        (param_assignment
          (simple_identifier)
          (constant_param_expression
            (constant_mintypmax_expression
              (constant_expression
                (constant_primary
                  (constant_function_call
                    (function_subroutine_call
                      (subroutine_call
                        (system_tf_call
                          (system_tf_identifier)
                          (list_of_arguments
                            (expression
                              left: (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier))))
                              right: (expression
                                (primary
                                  (primary_literal
                                    (integral_number
                                      (decimal_number
                                        (unsigned_number)))))))))))))))))))
    (text_macro_usage
      (simple_identifier)
      (list_of_actual_arguments
        (actual_argument
          (param_expression
            (mintypmax_expression
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))
        (actual_argument
          (param_expression
            (mintypmax_expression
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))))
    (net_declaration
      (net_type)
      (list_of_net_decl_assignments
        (net_decl_assignment
          (simple_identifier))
        (net_decl_assignment
          (simple_identifier))
        (net_decl_assignment
          (simple_identifier))
        (net_decl_assignment
          (simple_identifier))
        (net_decl_assignment
          (simple_identifier))))
    (net_declaration
      (net_type)
      (data_type_or_implicit
        (implicit_data_type
          (packed_dimension
            (constant_range
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_net_decl_assignments
        (net_decl_assignment
          (simple_identifier))))
    (net_declaration
      (net_type)
      (list_of_net_decl_assignments
        (net_decl_assignment
          (simple_identifier))))
    (net_declaration
      (net_type)
      (list_of_net_decl_assignments
        (net_decl_assignment
          (simple_identifier))))
    (net_declaration
      (net_type)
      (list_of_net_decl_assignments
        (net_decl_assignment
          (simple_identifier))))
    (net_declaration
      (net_type)
      (list_of_net_decl_assignments
        (net_decl_assignment
          (simple_identifier))))
    (module_instantiation
      instance_type: (simple_identifier)
      (parameter_value_assignment
        (list_of_parameter_value_assignments
          (ordered_parameter_assignment
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (primary_literal
                      (time_literal
                        (unsigned_number)
                        (time_unit))))))))))
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (ordered_port_connection
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))
    (module_instantiation
      instance_type: (simple_identifier)
      (parameter_value_assignment
        (list_of_parameter_value_assignments
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))))
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier)))))
    (one_line_comment)
    (one_line_comment)
    (initial_construct
      (statement_or_null
        (statement
          (statement_item
            (seq_block
              (statement_or_null
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (system_tf_call
                          (system_tf_identifier)))))))
              (statement_or_null
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (system_tf_call
                          (system_tf_identifier))))))))))))
    (one_line_comment)
    (one_line_comment)
    (data_declaration
      (data_type_or_implicit
        (data_type
          (simple_identifier)
          (packed_dimension
            (constant_range
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (module_instantiation
      instance_type: (simple_identifier)
      (parameter_value_assignment
        (list_of_parameter_value_assignments
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))))
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))
    (module_instantiation
      instance_type: (simple_identifier)
      (parameter_value_assignment
        (list_of_parameter_value_assignments
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))))
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))
                (select
                  (bit_select
                    (expression
                      (primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number)))))))))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))
                (select
                  (bit_select
                    (expression
                      (primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number)))))))))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))))
