============================================
basejump_stl/bsg_noc/bsg_mesh_router_buffered
============================================

/**
 *    bsg_mesh_router_buffered.sv
 *
 */


`include "bsg_defines.sv"
`include "bsg_noc_links.svh"


module bsg_mesh_router_buffered
  import bsg_mesh_router_pkg::*;
  #(parameter `BSG_INV_PARAM(width_p        )
    , parameter `BSG_INV_PARAM(x_cord_width_p )
    , parameter `BSG_INV_PARAM(y_cord_width_p )
    , parameter debug_p       = 0
    , parameter ruche_factor_X_p = 0
    , parameter ruche_factor_Y_p = 0
    , parameter dims_p        = 2
    , parameter dirs_lp       = (2*dims_p)+1
    , parameter stub_p        = { dirs_lp {1'b0}}  // SNEWP
    , parameter XY_order_p    = 1
    , parameter depopulated_p = 1
    , parameter bsg_ready_and_link_sif_width_lp=`bsg_ready_and_link_sif_width(width_p)
    // select whether to buffer the output
    , parameter repeater_output_p = { dirs_lp {1'b0}}  // SNEWP
    // credit interface
    , parameter use_credits_p = {dirs_lp{1'b0}}
    , parameter int fifo_els_p[dirs_lp-1:0] = '{2,2,2,2,2}
  )
  (
    input clk_i
    , input reset_i

    , input  [dirs_lp-1:0][bsg_ready_and_link_sif_width_lp-1:0] link_i
    , output [dirs_lp-1:0][bsg_ready_and_link_sif_width_lp-1:0] link_o

    , input [x_cord_width_p-1:0] my_x_i
    , input [y_cord_width_p-1:0] my_y_i
  );

   `declare_bsg_ready_and_link_sif_s(width_p,bsg_ready_and_link_sif_s);

   bsg_ready_and_link_sif_s [dirs_lp-1:0] link_i_cast, link_o_cast;

   assign link_i_cast =link_i;
   assign link_o = link_o_cast;

   logic [dirs_lp-1:0]              fifo_valid;
   logic [dirs_lp-1:0][width_p-1:0] fifo_data;
   logic [dirs_lp-1:0]              fifo_yumi;

   genvar                           i;

`ifndef BSG_HIDE_FROM_SYNTHESIS
   if (debug_p)
     for (i = 0; i < dirs_lp;i=i+1)
       begin
          always_ff @(negedge clk_i)
            $display("%m x=%d y=%d SNEWP[%d] v_i=%b ready_o=%b v_o=%b ready_i=%b %b"
                     ,my_x_i,my_y_i,i,link_i_cast[i].v,link_o_cast[i].ready_and_rev,
                     link_o_cast[i].v,link_i_cast[i].ready_and_rev,link_i[i]);
       end
`endif

  for (i = 0; i < dirs_lp; i=i+1) begin: rof
    if (stub_p[i]) begin: fi
      assign fifo_data   [i] = width_p ' (0);
      assign fifo_valid  [i] = 1'b0;

      // accept no data from outside of stubbed port
      assign link_o_cast[i].ready_and_rev = 1'b0;

`ifndef BSG_HIDE_FROM_SYNTHESIS
      always @(negedge clk_i)
        assert (reset_i !== '0 || ~link_o_cast[i].v) else
          $warning("## stubbed port %x received word %x",i,link_i_cast[i].data);
`endif
    end
    else begin: fi
      logic fifo_ready_lo;

      bsg_fifo_1r1w_small #(
        .width_p(width_p)
        ,.els_p(fifo_els_p[i])
      ) fifo (
        .clk_i(clk_i)
        ,.reset_i(reset_i)

        ,.v_i     (link_i_cast[i].v            )
        ,.data_i  (link_i_cast[i].data         )
        ,.ready_param_o (fifo_ready_lo)

        ,.v_o     (fifo_valid[i])
        ,.data_o  (fifo_data [i])
        ,.yumi_i  (fifo_yumi [i])
      );
      
      if (use_credits_p[i]) begin: cr
        bsg_dff_reset #(
          .width_p(1)
          ,.reset_val_p(0)
        ) dff0 (
          .clk_i(clk_i)
          ,.reset_i(reset_i)
          ,.data_i(fifo_yumi[i])
          ,.data_o(link_o_cast[i].ready_and_rev)
        );
        
`ifndef BSG_HIDE_FROM_SYNTHESIS
        always_ff @ (negedge clk_i) begin
          if (~reset_i) begin
            if (link_i_cast[i].v) begin
              assert(fifo_ready_lo)
                else $error("Trying to enque when there is no space in FIFO, while using credit interface. i =%d", i);
            end
          end
        end
`endif

      end
      else begin
        assign link_o_cast[i].ready_and_rev = fifo_ready_lo;      
      end

    end
  end

   // router does not have symmetric interfaces;
   // so we do not use bsg_ready_and_link_sif
   // and manually convert. support for arrays
   // of interfaces in systemverilog would
   // fix this.

   logic [dirs_lp-1:0]              valid_lo;
   logic [dirs_lp-1:0][width_p-1:0] data_lo;
   logic [dirs_lp-1:0]              ready_li;

   for (i = 0; i < dirs_lp; i=i+1)
     begin: rof2
        assign link_o_cast[i].v    = valid_lo[i];

        if (repeater_output_p[i] & ~stub_p[i])
          begin : macro
	     wire [width_p-1:0] tmp;

`ifndef BSG_HIDE_FROM_SYNTHESIS
            initial
               begin
                  $display("%m with buffers on %d",i);
               end
`endif
             bsg_inv #(.width_p(width_p),.vertical_p(i < 3)) data_lo_inv
               (.i (data_lo[i]         )
                ,.o(tmp)
                );

             bsg_inv #(.width_p(width_p),.vertical_p(i < 3)) data_lo_rep
               (.i (tmp)
                ,.o(link_o_cast[i].data)
                );

          end
        else
          assign link_o_cast[i].data = data_lo [i];

        assign ready_li[i] = link_i_cast[i].ready_and_rev;
     end

   bsg_mesh_router #( .width_p      (width_p      )
                      ,.x_cord_width_p(x_cord_width_p)
                      ,.y_cord_width_p(y_cord_width_p)
                      ,.ruche_factor_X_p(ruche_factor_X_p)
                      ,.ruche_factor_Y_p(ruche_factor_Y_p)
                      ,.dims_p        (dims_p)
                      ,.XY_order_p   (XY_order_p   )
                      ,.depopulated_p  (depopulated_p   )
                      ) bmr
   (.clk_i
    ,.reset_i
    ,.v_i    (fifo_valid)
    ,.data_i (fifo_data )
    ,.yumi_o (fifo_yumi )

    ,.v_o   (valid_lo)
    ,.data_o(data_lo)

    // this will be hardwired to 1 by inside of this module
    // if port is stubbed

    ,.ready_and_i(ready_li)

    ,.my_x_i
    ,.my_y_i
    );


endmodule

`BSG_ABSTRACT_MODULE(bsg_mesh_router_buffered)


----

(source_file
  (block_comment)
  (include_compiler_directive
    (quoted_string
      (quoted_string_item)))
  (include_compiler_directive
    (quoted_string
      (quoted_string_item)))
  (module_declaration
    (module_ansi_header
      (module_keyword)
      name: (simple_identifier)
      (package_import_declaration
        (package_import_item
          (simple_identifier)))
      (parameter_port_list
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (text_macro_usage
                  (simple_identifier)
                  (list_of_actual_arguments
                    (actual_argument
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (text_macro_usage
                  (simple_identifier)
                  (list_of_actual_arguments
                    (actual_argument
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (text_macro_usage
                  (simple_identifier)
                  (list_of_actual_arguments
                    (actual_argument
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      left: (constant_expression
                        (constant_primary
                          (constant_mintypmax_expression
                            (constant_expression
                              left: (constant_expression
                                (constant_primary
                                  (primary_literal
                                    (integral_number
                                      (decimal_number
                                        (unsigned_number))))))
                              right: (constant_expression
                                (constant_primary
                                  (simple_identifier)))))))
                      right: (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number)))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (constant_multiple_concatenation
                          (constant_expression
                            (constant_primary
                              (simple_identifier)))
                          (constant_concatenation
                            (constant_expression
                              (constant_primary
                                (primary_literal
                                  (integral_number
                                    (binary_number
                                      size: (unsigned_number)
                                      base: (binary_base)
                                      value: (binary_value))))))))))))))))
        (one_line_comment)
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (text_macro_usage
                        (simple_identifier)
                        (list_of_actual_arguments
                          (actual_argument
                            (param_expression
                              (mintypmax_expression
                                (expression
                                  (primary
                                    (hierarchical_identifier
                                      (simple_identifier))))))))))))))))
        (one_line_comment)
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (constant_multiple_concatenation
                          (constant_expression
                            (constant_primary
                              (simple_identifier)))
                          (constant_concatenation
                            (constant_expression
                              (constant_primary
                                (primary_literal
                                  (integral_number
                                    (binary_number
                                      size: (unsigned_number)
                                      base: (binary_base)
                                      value: (binary_value))))))))))))))))
        (one_line_comment)
        (one_line_comment)
        (parameter_port_declaration
          (parameter_declaration
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (constant_multiple_concatenation
                          (constant_expression
                            (constant_primary
                              (simple_identifier)))
                          (constant_concatenation
                            (constant_expression
                              (constant_primary
                                (primary_literal
                                  (integral_number
                                    (binary_number
                                      size: (unsigned_number)
                                      base: (binary_base)
                                      value: (binary_value))))))))))))))))
        (parameter_port_declaration
          (parameter_declaration
            (data_type_or_implicit
              (data_type
                (integer_atom_type)))
            (list_of_param_assignments
              (param_assignment
                (simple_identifier)
                (unpacked_dimension
                  (constant_range
                    (constant_expression
                      left: (constant_expression
                        (constant_primary
                          (simple_identifier)))
                      right: (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number)))))))
                    (constant_expression
                      (constant_primary
                        (primary_literal
                          (integral_number
                            (decimal_number
                              (unsigned_number))))))))
                (constant_param_expression
                  (constant_mintypmax_expression
                    (constant_expression
                      (constant_primary
                        (assignment_pattern_expression
                          (assignment_pattern
                            (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number))))))
                            (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number))))))
                            (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number))))))
                            (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number))))))
                            (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number)))))))))))))))))
      (list_of_port_declarations
        (ansi_port_declaration
          (net_port_header
            (port_direction))
          port_name: (simple_identifier))
        (ansi_port_declaration
          (net_port_header
            (port_direction))
          port_name: (simple_identifier))
        (ansi_port_declaration
          (net_port_header
            (port_direction)
            (net_port_type
              (data_type_or_implicit
                (implicit_data_type
                  (packed_dimension
                    (constant_range
                      (constant_expression
                        left: (constant_expression
                          (constant_primary
                            (simple_identifier)))
                        right: (constant_expression
                          (constant_primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number)))))))
                      (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number))))))))
                  (packed_dimension
                    (constant_range
                      (constant_expression
                        left: (constant_expression
                          (constant_primary
                            (simple_identifier)))
                        right: (constant_expression
                          (constant_primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number)))))))
                      (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number))))))))))))
          port_name: (simple_identifier))
        (ansi_port_declaration
          (net_port_header
            (port_direction)
            (net_port_type
              (data_type_or_implicit
                (implicit_data_type
                  (packed_dimension
                    (constant_range
                      (constant_expression
                        left: (constant_expression
                          (constant_primary
                            (simple_identifier)))
                        right: (constant_expression
                          (constant_primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number)))))))
                      (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number))))))))
                  (packed_dimension
                    (constant_range
                      (constant_expression
                        left: (constant_expression
                          (constant_primary
                            (simple_identifier)))
                        right: (constant_expression
                          (constant_primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number)))))))
                      (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number))))))))))))
          port_name: (simple_identifier))
        (ansi_port_declaration
          (net_port_header
            (port_direction)
            (net_port_type
              (data_type_or_implicit
                (implicit_data_type
                  (packed_dimension
                    (constant_range
                      (constant_expression
                        left: (constant_expression
                          (constant_primary
                            (simple_identifier)))
                        right: (constant_expression
                          (constant_primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number)))))))
                      (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number))))))))))))
          port_name: (simple_identifier))
        (ansi_port_declaration
          (net_port_header
            (port_direction)
            (net_port_type
              (data_type_or_implicit
                (implicit_data_type
                  (packed_dimension
                    (constant_range
                      (constant_expression
                        left: (constant_expression
                          (constant_primary
                            (simple_identifier)))
                        right: (constant_expression
                          (constant_primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number)))))))
                      (constant_expression
                        (constant_primary
                          (primary_literal
                            (integral_number
                              (decimal_number
                                (unsigned_number))))))))))))
          port_name: (simple_identifier))))
    (text_macro_usage
      (simple_identifier)
      (list_of_actual_arguments
        (actual_argument
          (param_expression
            (mintypmax_expression
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))
        (actual_argument
          (param_expression
            (mintypmax_expression
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (simple_identifier)
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))
        (variable_decl_assignment
          name: (simple_identifier))))
    (continuous_assign
      (list_of_net_assignments
        (net_assignment
          (net_lvalue
            (simple_identifier))
          (expression
            (primary
              (hierarchical_identifier
                (simple_identifier)))))))
    (continuous_assign
      (list_of_net_assignments
        (net_assignment
          (net_lvalue
            (simple_identifier))
          (expression
            (primary
              (hierarchical_identifier
                (simple_identifier)))))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (genvar_declaration
      (list_of_genvar_identifiers
        (simple_identifier)))
    (conditional_compilation_directive
      (ifdef_condition
        (simple_identifier)))
    (conditional_generate_construct
      (if_generate_construct
        (constant_expression
          (constant_primary
            (simple_identifier)))
        (generate_block
          (loop_generate_construct
            (genvar_initialization
              (simple_identifier)
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number)))))))
            (constant_expression
              left: (constant_expression
                (constant_primary
                  (simple_identifier)))
              right: (constant_expression
                (constant_primary
                  (simple_identifier))))
            (genvar_iteration
              (simple_identifier)
              (assignment_operator)
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number))))))))
            (generate_block
              (always_construct
                (always_keyword)
                (statement
                  (statement_item
                    (procedural_timing_control_statement
                      (event_control
                        (clocking_event
                          (event_expression
                            (edge_identifier)
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)))))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (subroutine_call_statement
                              (subroutine_call
                                (system_tf_call
                                  (system_tf_identifier)
                                  (list_of_arguments
                                    (expression
                                      (primary
                                        (primary_literal
                                          (string_literal
                                            (quoted_string
                                              (quoted_string_item))))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier)
                                          (constant_bit_select
                                            (constant_expression
                                              (constant_primary
                                                (simple_identifier))))
                                          (simple_identifier))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier)
                                          (constant_bit_select
                                            (constant_expression
                                              (constant_primary
                                                (simple_identifier))))
                                          (simple_identifier))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier)
                                          (constant_bit_select
                                            (constant_expression
                                              (constant_primary
                                                (simple_identifier))))
                                          (simple_identifier))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier)
                                          (constant_bit_select
                                            (constant_expression
                                              (constant_primary
                                                (simple_identifier))))
                                          (simple_identifier))))
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier))
                                        (select
                                          (bit_select
                                            (expression
                                              (primary
                                                (hierarchical_identifier
                                                  (simple_identifier))))))))))))))))))))))))
    (conditional_compilation_directive)
    (loop_generate_construct
      (genvar_initialization
        (simple_identifier)
        (constant_expression
          (constant_primary
            (primary_literal
              (integral_number
                (decimal_number
                  (unsigned_number)))))))
      (constant_expression
        left: (constant_expression
          (constant_primary
            (simple_identifier)))
        right: (constant_expression
          (constant_primary
            (simple_identifier))))
      (genvar_iteration
        (simple_identifier)
        (assignment_operator)
        (constant_expression
          left: (constant_expression
            (constant_primary
              (simple_identifier)))
          right: (constant_expression
            (constant_primary
              (primary_literal
                (integral_number
                  (decimal_number
                    (unsigned_number))))))))
      (generate_block
        name: (simple_identifier)
        (conditional_generate_construct
          (if_generate_construct
            (constant_expression
              (constant_primary
                (simple_identifier)
                (constant_select
                  (constant_bit_select
                    (constant_expression
                      (constant_primary
                        (simple_identifier)))))))
            (generate_block
              name: (simple_identifier)
              (continuous_assign
                (list_of_net_assignments
                  (net_assignment
                    (net_lvalue
                      (simple_identifier)
                      (constant_select
                        (constant_bit_select
                          (constant_expression
                            (constant_primary
                              (simple_identifier))))))
                    (expression
                      (primary
                        (cast
                          (casting_type
                            (simple_identifier))
                          (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number))))))))))))
              (continuous_assign
                (list_of_net_assignments
                  (net_assignment
                    (net_lvalue
                      (simple_identifier)
                      (constant_select
                        (constant_bit_select
                          (constant_expression
                            (constant_primary
                              (simple_identifier))))))
                    (expression
                      (primary
                        (primary_literal
                          (integral_number
                            (binary_number
                              size: (unsigned_number)
                              base: (binary_base)
                              value: (binary_value)))))))))
              (one_line_comment)
              (continuous_assign
                (list_of_net_assignments
                  (net_assignment
                    (net_lvalue
                      (hierarchical_identifier
                        (simple_identifier)
                        (constant_bit_select
                          (constant_expression
                            (constant_primary
                              (simple_identifier))))
                        (simple_identifier)))
                    (expression
                      (primary
                        (primary_literal
                          (integral_number
                            (binary_number
                              size: (unsigned_number)
                              base: (binary_base)
                              value: (binary_value)))))))))
              (conditional_compilation_directive
                (ifdef_condition
                  (simple_identifier)))
              (always_construct
                (always_keyword)
                (statement
                  (statement_item
                    (procedural_timing_control_statement
                      (event_control
                        (clocking_event
                          (event_expression
                            (edge_identifier)
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)))))))
                      (statement_or_null
                        (statement
                          (statement_item
                            (simple_immediate_assert_statement
                              (expression
                                left: (expression
                                  left: (expression
                                    (primary
                                      (hierarchical_identifier
                                        (simple_identifier))))
                                  right: (expression
                                    (primary
                                      (primary_literal
                                        (unbased_unsized_literal)))))
                                right: (expression
                                  operator: (unary_operator)
                                  argument: (primary
                                    (hierarchical_identifier
                                      (simple_identifier)
                                      (constant_bit_select
                                        (constant_expression
                                          (constant_primary
                                            (simple_identifier))))
                                      (simple_identifier)))))
                              (action_block
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (subroutine_call_statement
                                        (severity_system_task
                                          (list_of_arguments
                                            (expression
                                              (primary
                                                (primary_literal
                                                  (string_literal
                                                    (quoted_string
                                                      (quoted_string_item))))))
                                            (expression
                                              (primary
                                                (hierarchical_identifier
                                                  (simple_identifier))))
                                            (expression
                                              (primary
                                                (hierarchical_identifier
                                                  (simple_identifier)
                                                  (constant_bit_select
                                                    (constant_expression
                                                      (constant_primary
                                                        (simple_identifier))))
                                                  (simple_identifier)))))))))))))))))))
              (conditional_compilation_directive))
            (generate_block
              name: (simple_identifier)
              (data_declaration
                (data_type_or_implicit
                  (data_type
                    (integer_vector_type)))
                (list_of_variable_decl_assignments
                  (variable_decl_assignment
                    name: (simple_identifier))))
              (module_instantiation
                instance_type: (simple_identifier)
                (parameter_value_assignment
                  (list_of_parameter_value_assignments
                    (named_parameter_assignment
                      (simple_identifier)
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))
                    (named_parameter_assignment
                      (simple_identifier)
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))
                              (select
                                (bit_select
                                  (expression
                                    (primary
                                      (hierarchical_identifier
                                        (simple_identifier)))))))))))))
                (hierarchical_instance
                  (name_of_instance
                    instance_name: (simple_identifier))
                  (list_of_port_connections
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)
                            (constant_bit_select
                              (constant_expression
                                (constant_primary
                                  (simple_identifier))))
                            (simple_identifier)))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)
                            (constant_bit_select
                              (constant_expression
                                (constant_primary
                                  (simple_identifier))))
                            (simple_identifier)))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier))
                          (select
                            (bit_select
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier))
                          (select
                            (bit_select
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier))
                          (select
                            (bit_select
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier))))))))))))
              (conditional_generate_construct
                (if_generate_construct
                  (constant_expression
                    (constant_primary
                      (simple_identifier)
                      (constant_select
                        (constant_bit_select
                          (constant_expression
                            (constant_primary
                              (simple_identifier)))))))
                  (generate_block
                    name: (simple_identifier)
                    (module_instantiation
                      instance_type: (simple_identifier)
                      (parameter_value_assignment
                        (list_of_parameter_value_assignments
                          (named_parameter_assignment
                            (simple_identifier)
                            (param_expression
                              (mintypmax_expression
                                (expression
                                  (primary
                                    (primary_literal
                                      (integral_number
                                        (decimal_number
                                          (unsigned_number)))))))))
                          (named_parameter_assignment
                            (simple_identifier)
                            (param_expression
                              (mintypmax_expression
                                (expression
                                  (primary
                                    (primary_literal
                                      (integral_number
                                        (decimal_number
                                          (unsigned_number)))))))))))
                      (hierarchical_instance
                        (name_of_instance
                          instance_name: (simple_identifier))
                        (list_of_port_connections
                          (named_port_connection
                            port_name: (simple_identifier)
                            connection: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)))))
                          (named_port_connection
                            port_name: (simple_identifier)
                            connection: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)))))
                          (named_port_connection
                            port_name: (simple_identifier)
                            connection: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))
                                (select
                                  (bit_select
                                    (expression
                                      (primary
                                        (hierarchical_identifier
                                          (simple_identifier)))))))))
                          (named_port_connection
                            port_name: (simple_identifier)
                            connection: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier)
                                  (constant_bit_select
                                    (constant_expression
                                      (constant_primary
                                        (simple_identifier))))
                                  (simple_identifier))))))))
                    (conditional_compilation_directive
                      (ifdef_condition
                        (simple_identifier)))
                    (always_construct
                      (always_keyword)
                      (statement
                        (statement_item
                          (procedural_timing_control_statement
                            (event_control
                              (clocking_event
                                (event_expression
                                  (edge_identifier)
                                  (expression
                                    (primary
                                      (hierarchical_identifier
                                        (simple_identifier)))))))
                            (statement_or_null
                              (statement
                                (statement_item
                                  (seq_block
                                    (statement_or_null
                                      (statement
                                        (statement_item
                                          (conditional_statement
                                            (cond_predicate
                                              (expression
                                                operator: (unary_operator)
                                                argument: (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier)))))
                                            (statement_or_null
                                              (statement
                                                (statement_item
                                                  (seq_block
                                                    (statement_or_null
                                                      (statement
                                                        (statement_item
                                                          (conditional_statement
                                                            (cond_predicate
                                                              (expression
                                                                (primary
                                                                  (hierarchical_identifier
                                                                    (simple_identifier)
                                                                    (constant_bit_select
                                                                      (constant_expression
                                                                        (constant_primary
                                                                          (simple_identifier))))
                                                                    (simple_identifier)))))
                                                            (statement_or_null
                                                              (statement
                                                                (statement_item
                                                                  (seq_block
                                                                    (statement_or_null
                                                                      (statement
                                                                        (statement_item
                                                                          (simple_immediate_assert_statement
                                                                            (expression
                                                                              (primary
                                                                                (hierarchical_identifier
                                                                                  (simple_identifier))))
                                                                            (action_block
                                                                              (statement_or_null
                                                                                (statement
                                                                                  (statement_item
                                                                                    (subroutine_call_statement
                                                                                      (severity_system_task
                                                                                        (list_of_arguments
                                                                                          (expression
                                                                                            (primary
                                                                                              (primary_literal
                                                                                                (string_literal
                                                                                                  (quoted_string
                                                                                                    (quoted_string_item))))))
                                                                                          (expression
                                                                                            (primary
                                                                                              (hierarchical_identifier
                                                                                                (simple_identifier)))))))))))))))))))))))))))))))))))))))
                    (conditional_compilation_directive))
                  (generate_block
                    (continuous_assign
                      (list_of_net_assignments
                        (net_assignment
                          (net_lvalue
                            (hierarchical_identifier
                              (simple_identifier)
                              (constant_bit_select
                                (constant_expression
                                  (constant_primary
                                    (simple_identifier))))
                              (simple_identifier)))
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))))))))))
    (one_line_comment)
    (one_line_comment)
    (one_line_comment)
    (one_line_comment)
    (one_line_comment)
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (data_declaration
      (data_type_or_implicit
        (data_type
          (integer_vector_type)
          (packed_dimension
            (constant_range
              (constant_expression
                left: (constant_expression
                  (constant_primary
                    (simple_identifier)))
                right: (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number)))))))
              (constant_expression
                (constant_primary
                  (primary_literal
                    (integral_number
                      (decimal_number
                        (unsigned_number))))))))))
      (list_of_variable_decl_assignments
        (variable_decl_assignment
          name: (simple_identifier))))
    (loop_generate_construct
      (genvar_initialization
        (simple_identifier)
        (constant_expression
          (constant_primary
            (primary_literal
              (integral_number
                (decimal_number
                  (unsigned_number)))))))
      (constant_expression
        left: (constant_expression
          (constant_primary
            (simple_identifier)))
        right: (constant_expression
          (constant_primary
            (simple_identifier))))
      (genvar_iteration
        (simple_identifier)
        (assignment_operator)
        (constant_expression
          left: (constant_expression
            (constant_primary
              (simple_identifier)))
          right: (constant_expression
            (constant_primary
              (primary_literal
                (integral_number
                  (decimal_number
                    (unsigned_number))))))))
      (generate_block
        name: (simple_identifier)
        (continuous_assign
          (list_of_net_assignments
            (net_assignment
              (net_lvalue
                (hierarchical_identifier
                  (simple_identifier)
                  (constant_bit_select
                    (constant_expression
                      (constant_primary
                        (simple_identifier))))
                  (simple_identifier)))
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier))
                  (select
                    (bit_select
                      (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)))))))))))
        (conditional_generate_construct
          (if_generate_construct
            (constant_expression
              left: (constant_expression
                (constant_primary
                  (simple_identifier)
                  (constant_select
                    (constant_bit_select
                      (constant_expression
                        (constant_primary
                          (simple_identifier)))))))
              right: (constant_expression
                operator: (unary_operator)
                argument: (constant_primary
                  (simple_identifier)
                  (constant_select
                    (constant_bit_select
                      (constant_expression
                        (constant_primary
                          (simple_identifier))))))))
            (generate_block
              name: (simple_identifier)
              (net_declaration
                (net_type)
                (data_type_or_implicit
                  (implicit_data_type
                    (packed_dimension
                      (constant_range
                        (constant_expression
                          left: (constant_expression
                            (constant_primary
                              (simple_identifier)))
                          right: (constant_expression
                            (constant_primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number)))))))
                        (constant_expression
                          (constant_primary
                            (primary_literal
                              (integral_number
                                (decimal_number
                                  (unsigned_number))))))))))
                (list_of_net_decl_assignments
                  (net_decl_assignment
                    (simple_identifier))))
              (conditional_compilation_directive
                (ifdef_condition
                  (simple_identifier)))
              (initial_construct
                (statement_or_null
                  (statement
                    (statement_item
                      (seq_block
                        (statement_or_null
                          (statement
                            (statement_item
                              (subroutine_call_statement
                                (subroutine_call
                                  (system_tf_call
                                    (system_tf_identifier)
                                    (list_of_arguments
                                      (expression
                                        (primary
                                          (primary_literal
                                            (string_literal
                                              (quoted_string
                                                (quoted_string_item))))))
                                      (expression
                                        (primary
                                          (hierarchical_identifier
                                            (simple_identifier))))))))))))))))
              (conditional_compilation_directive)
              (module_instantiation
                instance_type: (simple_identifier)
                (parameter_value_assignment
                  (list_of_parameter_value_assignments
                    (named_parameter_assignment
                      (simple_identifier)
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))
                    (named_parameter_assignment
                      (simple_identifier)
                      (param_expression
                        (mintypmax_expression
                          (expression
                            left: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            right: (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number))))))))))))
                (hierarchical_instance
                  (name_of_instance
                    instance_name: (simple_identifier))
                  (list_of_port_connections
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier))
                          (select
                            (bit_select
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier))))))))
              (module_instantiation
                instance_type: (simple_identifier)
                (parameter_value_assignment
                  (list_of_parameter_value_assignments
                    (named_parameter_assignment
                      (simple_identifier)
                      (param_expression
                        (mintypmax_expression
                          (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))))
                    (named_parameter_assignment
                      (simple_identifier)
                      (param_expression
                        (mintypmax_expression
                          (expression
                            left: (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            right: (expression
                              (primary
                                (primary_literal
                                  (integral_number
                                    (decimal_number
                                      (unsigned_number))))))))))))
                (hierarchical_instance
                  (name_of_instance
                    instance_name: (simple_identifier))
                  (list_of_port_connections
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)))))
                    (named_port_connection
                      port_name: (simple_identifier)
                      connection: (expression
                        (primary
                          (hierarchical_identifier
                            (simple_identifier)
                            (constant_bit_select
                              (constant_expression
                                (constant_primary
                                  (simple_identifier))))
                            (simple_identifier)))))))))
            (generate_block
              (continuous_assign
                (list_of_net_assignments
                  (net_assignment
                    (net_lvalue
                      (hierarchical_identifier
                        (simple_identifier)
                        (constant_bit_select
                          (constant_expression
                            (constant_primary
                              (simple_identifier))))
                        (simple_identifier)))
                    (expression
                      (primary
                        (hierarchical_identifier
                          (simple_identifier))
                        (select
                          (bit_select
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))))))))))))
        (continuous_assign
          (list_of_net_assignments
            (net_assignment
              (net_lvalue
                (simple_identifier)
                (constant_select
                  (constant_bit_select
                    (constant_expression
                      (constant_primary
                        (simple_identifier))))))
              (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)
                    (constant_bit_select
                      (constant_expression
                        (constant_primary
                          (simple_identifier))))
                    (simple_identifier)))))))))
    (module_instantiation
      instance_type: (simple_identifier)
      (parameter_value_assignment
        (list_of_parameter_value_assignments
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))
          (named_parameter_assignment
            (simple_identifier)
            (param_expression
              (mintypmax_expression
                (expression
                  (primary
                    (hierarchical_identifier
                      (simple_identifier)))))))))
      (hierarchical_instance
        (name_of_instance
          instance_name: (simple_identifier))
        (list_of_port_connections
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (one_line_comment)
          (one_line_comment)
          (named_port_connection
            port_name: (simple_identifier)
            connection: (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier)))))
          (named_port_connection
            port_name: (simple_identifier))
          (named_port_connection
            port_name: (simple_identifier))))))
  (text_macro_usage
    (simple_identifier)
    (list_of_actual_arguments
      (actual_argument
        (param_expression
          (mintypmax_expression
            (expression
              (primary
                (hierarchical_identifier
                  (simple_identifier))))))))))
