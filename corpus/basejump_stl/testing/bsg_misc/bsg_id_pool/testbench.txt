============================================
basejump_stl/testing/bsg_misc/bsg_id_pool/testbench
============================================

module testbench();

  parameter els_p = 32;
  parameter lg_els_lp = `BSG_SAFE_CLOG2(els_p);

  bit clk;
  bit reset;

  bsg_nonsynth_clock_gen #(
    .cycle_time_p(1000)
  ) cg0 (
    .o(clk)
  );

  bsg_nonsynth_reset_gen #(
    .reset_cycles_lo_p(0)
    ,.reset_cycles_hi_p(8)
  ) rg0 (
    .clk_i(clk)
    ,.async_reset_o(reset)
  );

   logic pool_v_lo;
   logic [lg_els_lp-1:0] pool_id_lo;

   logic 		 pool_yumi_li;
   logic 		 pool_dealloc_v_li;
   logic [lg_els_lp-1:0] pool_dealloc_id_li;
   
   bsg_id_pool #(.els_p(els_p)
		) pool
     (.clk_i(clk)
      ,.reset_i(reset)
      
      ,.alloc_id_o  (pool_id_lo)
      ,.alloc_v_o   (pool_v_lo)
      ,.alloc_yumi_i(pool_yumi_li)
      ,.dealloc_v_i(pool_dealloc_v_li)
      ,.dealloc_id_i(pool_dealloc_id_li)
      );

   integer 		 i;

   always @(negedge clk)
     $display("v=%b id=%b",pool_v_lo, pool_id_lo);

   always @(posedge clk)
     $display("yumi_li=%b dealloc_v=%b pool_dealloc_id_li=%b",pool_yumi_li, pool_dealloc_v_li, pool_dealloc_id_li);     
   
   initial
     begin
	pool_dealloc_v_li = 1'b0;
	pool_yumi_li = 1'b0;
	@(negedge reset);
	@(negedge clk);
	for (i = 0; i < els_p; i++)
	  begin
	     @(negedge clk);
	     pool_yumi_li = 1'b1;
	  end

	@(negedge clk);
	pool_yumi_li = 1'b0;
	$display("done allocating");

	
	for (i = els_p-1; i >= 0; i--)
	  begin
	     @(negedge clk);
	     pool_dealloc_id_li = i;
	     pool_dealloc_v_li = 1'b1;
	  end

	@(negedge clk);
	pool_dealloc_v_li = 1'b0;

	$display("done deallocating");
	
	for (i = 0; i < els_p; i++)
	  begin
	     @(negedge clk);
	     pool_yumi_li = 1'b1;
	  end
	@(negedge clk);
	
	pool_yumi_li = 1'b0;
	@(negedge clk);
	
	$finish;
     end
endmodule  

----

(source_file
  (module_declaration
    (module_nonansi_header
      (module_keyword)
      name: (simple_identifier)
      (list_of_ports))
    (module_item
      (parameter_declaration
        (list_of_param_assignments
          (param_assignment
            (simple_identifier)
            (constant_param_expression
              (constant_mintypmax_expression
                (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number))))))))))))
    (module_item
      (parameter_declaration
        (list_of_param_assignments
          (param_assignment
            (simple_identifier)
            (constant_param_expression
              (constant_mintypmax_expression
                (constant_expression
                  (text_macro_usage
                    (simple_identifier)
                    (list_of_actual_arguments
                      (actual_argument
                        (param_expression
                          (mintypmax_expression
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))))))))))))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_vector_type)))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_vector_type)))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (module_instantiation
        instance_type: (simple_identifier)
        (parameter_value_assignment
          (list_of_parameter_value_assignments
            (named_parameter_assignment
              (simple_identifier)
              (param_expression
                (mintypmax_expression
                  (expression
                    (primary
                      (primary_literal
                        (integral_number
                          (decimal_number
                            (unsigned_number)))))))))))
        (hierarchical_instance
          (name_of_instance
            instance_name: (simple_identifier))
          (list_of_port_connections
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))))
    (module_item
      (module_instantiation
        instance_type: (simple_identifier)
        (parameter_value_assignment
          (list_of_parameter_value_assignments
            (named_parameter_assignment
              (simple_identifier)
              (param_expression
                (mintypmax_expression
                  (expression
                    (primary
                      (primary_literal
                        (integral_number
                          (decimal_number
                            (unsigned_number)))))))))
            (named_parameter_assignment
              (simple_identifier)
              (param_expression
                (mintypmax_expression
                  (expression
                    (primary
                      (primary_literal
                        (integral_number
                          (decimal_number
                            (unsigned_number)))))))))))
        (hierarchical_instance
          (name_of_instance
            instance_name: (simple_identifier))
          (list_of_port_connections
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_vector_type)))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_vector_type)
            (packed_dimension
              (constant_range
                (constant_expression
                  left: (constant_expression
                    (constant_primary
                      (simple_identifier)))
                  right: (constant_expression
                    (constant_primary
                      (primary_literal
                        (integral_number
                          (decimal_number
                            (unsigned_number)))))))
                (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number))))))))))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_vector_type)))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_vector_type)))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_vector_type)
            (packed_dimension
              (constant_range
                (constant_expression
                  left: (constant_expression
                    (constant_primary
                      (simple_identifier)))
                  right: (constant_expression
                    (constant_primary
                      (primary_literal
                        (integral_number
                          (decimal_number
                            (unsigned_number)))))))
                (constant_expression
                  (constant_primary
                    (primary_literal
                      (integral_number
                        (decimal_number
                          (unsigned_number))))))))))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (module_instantiation
        instance_type: (simple_identifier)
        (parameter_value_assignment
          (list_of_parameter_value_assignments
            (named_parameter_assignment
              (simple_identifier)
              (param_expression
                (mintypmax_expression
                  (expression
                    (primary
                      (hierarchical_identifier
                        (simple_identifier)))))))))
        (hierarchical_instance
          (name_of_instance
            instance_name: (simple_identifier))
          (list_of_port_connections
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))
            (named_port_connection
              port_name: (simple_identifier)
              connection: (expression
                (primary
                  (hierarchical_identifier
                    (simple_identifier)))))))))
    (module_item
      (data_declaration
        (data_type_or_implicit
          (data_type
            (integer_atom_type)))
        (list_of_variable_decl_assignments
          (variable_decl_assignment
            name: (simple_identifier)))))
    (module_item
      (always_construct
        (always_keyword)
        (statement
          (statement_item
            (procedural_timing_control_statement
              (event_control
                (clocking_event
                  (event_expression
                    (edge_identifier)
                    (expression
                      (primary
                        (hierarchical_identifier
                          (simple_identifier)))))))
              (statement_or_null
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (system_tf_call
                          (system_tf_identifier)
                          (list_of_arguments
                            (expression
                              (primary
                                (primary_literal
                                  (string_literal
                                    (quoted_string
                                      (quoted_string_item))))))
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))))))))))))))
    (module_item
      (always_construct
        (always_keyword)
        (statement
          (statement_item
            (procedural_timing_control_statement
              (event_control
                (clocking_event
                  (event_expression
                    (edge_identifier)
                    (expression
                      (primary
                        (hierarchical_identifier
                          (simple_identifier)))))))
              (statement_or_null
                (statement
                  (statement_item
                    (subroutine_call_statement
                      (subroutine_call
                        (system_tf_call
                          (system_tf_identifier)
                          (list_of_arguments
                            (expression
                              (primary
                                (primary_literal
                                  (string_literal
                                    (quoted_string
                                      (quoted_string_item))))))
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))
                            (expression
                              (primary
                                (hierarchical_identifier
                                  (simple_identifier))))))))))))))))
    (module_item
      (initial_construct
        (statement_or_null
          (statement
            (statement_item
              (seq_block
                (statement_or_null
                  (statement
                    (statement_item
                      (blocking_assignment
                        (operator_assignment
                          (variable_lvalue
                            (hierarchical_identifier
                              (simple_identifier)))
                          (assignment_operator)
                          (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (binary_number
                                    size: (unsigned_number)
                                    base: (binary_base)
                                    value: (binary_value)))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (blocking_assignment
                        (operator_assignment
                          (variable_lvalue
                            (hierarchical_identifier
                              (simple_identifier)))
                          (assignment_operator)
                          (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (binary_number
                                    size: (unsigned_number)
                                    base: (binary_base)
                                    value: (binary_value)))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (procedural_timing_control_statement
                        (event_control
                          (clocking_event
                            (event_expression
                              (edge_identifier)
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))
                        (statement_or_null)))))
                (statement_or_null
                  (statement
                    (statement_item
                      (procedural_timing_control_statement
                        (event_control
                          (clocking_event
                            (event_expression
                              (edge_identifier)
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))
                        (statement_or_null)))))
                (statement_or_null
                  (statement
                    (statement_item
                      (loop_statement
                        (for_initialization
                          (list_of_variable_assignments
                            (variable_assignment
                              (variable_lvalue
                                (hierarchical_identifier
                                  (simple_identifier)))
                              (expression
                                (primary
                                  (primary_literal
                                    (integral_number
                                      (decimal_number
                                        (unsigned_number)))))))))
                        (expression
                          left: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))
                          right: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))
                        (for_step
                          (inc_or_dec_expression
                            (variable_lvalue
                              (hierarchical_identifier
                                (simple_identifier)))
                            (inc_or_dec_operator)))
                        (statement_or_null
                          (statement
                            (statement_item
                              (seq_block
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (procedural_timing_control_statement
                                        (event_control
                                          (clocking_event
                                            (event_expression
                                              (edge_identifier)
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier)))))))
                                        (statement_or_null)))))
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (blocking_assignment
                                        (operator_assignment
                                          (variable_lvalue
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (assignment_operator)
                                          (expression
                                            (primary
                                              (primary_literal
                                                (integral_number
                                                  (binary_number
                                                    size: (unsigned_number)
                                                    base: (binary_base)
                                                    value: (binary_value)))))))))))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (procedural_timing_control_statement
                        (event_control
                          (clocking_event
                            (event_expression
                              (edge_identifier)
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))
                        (statement_or_null)))))
                (statement_or_null
                  (statement
                    (statement_item
                      (blocking_assignment
                        (operator_assignment
                          (variable_lvalue
                            (hierarchical_identifier
                              (simple_identifier)))
                          (assignment_operator)
                          (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (binary_number
                                    size: (unsigned_number)
                                    base: (binary_base)
                                    value: (binary_value)))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (subroutine_call_statement
                        (subroutine_call
                          (system_tf_call
                            (system_tf_identifier)
                            (list_of_arguments
                              (expression
                                (primary
                                  (primary_literal
                                    (string_literal
                                      (quoted_string
                                        (quoted_string_item)))))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (loop_statement
                        (for_initialization
                          (list_of_variable_assignments
                            (variable_assignment
                              (variable_lvalue
                                (hierarchical_identifier
                                  (simple_identifier)))
                              (expression
                                left: (expression
                                  (primary
                                    (hierarchical_identifier
                                      (simple_identifier))))
                                right: (expression
                                  (primary
                                    (primary_literal
                                      (integral_number
                                        (decimal_number
                                          (unsigned_number))))))))))
                        (expression
                          left: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))
                          right: (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (decimal_number
                                    (unsigned_number)))))))
                        (for_step
                          (inc_or_dec_expression
                            (variable_lvalue
                              (hierarchical_identifier
                                (simple_identifier)))
                            (inc_or_dec_operator)))
                        (statement_or_null
                          (statement
                            (statement_item
                              (seq_block
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (procedural_timing_control_statement
                                        (event_control
                                          (clocking_event
                                            (event_expression
                                              (edge_identifier)
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier)))))))
                                        (statement_or_null)))))
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (blocking_assignment
                                        (operator_assignment
                                          (variable_lvalue
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (assignment_operator)
                                          (expression
                                            (primary
                                              (hierarchical_identifier
                                                (simple_identifier)))))))))
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (blocking_assignment
                                        (operator_assignment
                                          (variable_lvalue
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (assignment_operator)
                                          (expression
                                            (primary
                                              (primary_literal
                                                (integral_number
                                                  (binary_number
                                                    size: (unsigned_number)
                                                    base: (binary_base)
                                                    value: (binary_value)))))))))))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (procedural_timing_control_statement
                        (event_control
                          (clocking_event
                            (event_expression
                              (edge_identifier)
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))
                        (statement_or_null)))))
                (statement_or_null
                  (statement
                    (statement_item
                      (blocking_assignment
                        (operator_assignment
                          (variable_lvalue
                            (hierarchical_identifier
                              (simple_identifier)))
                          (assignment_operator)
                          (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (binary_number
                                    size: (unsigned_number)
                                    base: (binary_base)
                                    value: (binary_value)))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (subroutine_call_statement
                        (subroutine_call
                          (system_tf_call
                            (system_tf_identifier)
                            (list_of_arguments
                              (expression
                                (primary
                                  (primary_literal
                                    (string_literal
                                      (quoted_string
                                        (quoted_string_item)))))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (loop_statement
                        (for_initialization
                          (list_of_variable_assignments
                            (variable_assignment
                              (variable_lvalue
                                (hierarchical_identifier
                                  (simple_identifier)))
                              (expression
                                (primary
                                  (primary_literal
                                    (integral_number
                                      (decimal_number
                                        (unsigned_number)))))))))
                        (expression
                          left: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier))))
                          right: (expression
                            (primary
                              (hierarchical_identifier
                                (simple_identifier)))))
                        (for_step
                          (inc_or_dec_expression
                            (variable_lvalue
                              (hierarchical_identifier
                                (simple_identifier)))
                            (inc_or_dec_operator)))
                        (statement_or_null
                          (statement
                            (statement_item
                              (seq_block
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (procedural_timing_control_statement
                                        (event_control
                                          (clocking_event
                                            (event_expression
                                              (edge_identifier)
                                              (expression
                                                (primary
                                                  (hierarchical_identifier
                                                    (simple_identifier)))))))
                                        (statement_or_null)))))
                                (statement_or_null
                                  (statement
                                    (statement_item
                                      (blocking_assignment
                                        (operator_assignment
                                          (variable_lvalue
                                            (hierarchical_identifier
                                              (simple_identifier)))
                                          (assignment_operator)
                                          (expression
                                            (primary
                                              (primary_literal
                                                (integral_number
                                                  (binary_number
                                                    size: (unsigned_number)
                                                    base: (binary_base)
                                                    value: (binary_value)))))))))))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (procedural_timing_control_statement
                        (event_control
                          (clocking_event
                            (event_expression
                              (edge_identifier)
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))
                        (statement_or_null)))))
                (statement_or_null
                  (statement
                    (statement_item
                      (blocking_assignment
                        (operator_assignment
                          (variable_lvalue
                            (hierarchical_identifier
                              (simple_identifier)))
                          (assignment_operator)
                          (expression
                            (primary
                              (primary_literal
                                (integral_number
                                  (binary_number
                                    size: (unsigned_number)
                                    base: (binary_base)
                                    value: (binary_value)))))))))))
                (statement_or_null
                  (statement
                    (statement_item
                      (procedural_timing_control_statement
                        (event_control
                          (clocking_event
                            (event_expression
                              (edge_identifier)
                              (expression
                                (primary
                                  (hierarchical_identifier
                                    (simple_identifier)))))))
                        (statement_or_null)))))
                (statement_or_null
                  (statement
                    (statement_item
                      (subroutine_call_statement
                        (simulation_control_task)))))))))))))
